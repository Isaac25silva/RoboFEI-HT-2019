#coding: utf-8
 # ----------------------------------------------------------------------------
 # ****************************************************************************
 # * @file SharedMemory.py
 # * @author Isaac Jesus da Silva - ROBOFEI-HT - FEI üòõ
 # * @version V0.0.2
 # * @created 08/09/2015
 # * @Modified 16/09/2015
 # * @e-mail isaac25silva@yahoo.com.br
 # * @brief Shared Memory
 # ****************************************************************************
 # ****************************************************************************
import ctypes
import time
import os


# Classe do BlackBoard--------------------------------------------------------------------
class SharedMemory(object):
# Classe que l√™ e escreve na mem√≥ria compartilhada do sistema '''

    def shd_constructor(self,KEY):
        #print "Start the Class Blackboard"
        # Usando memoria compartilhada a partir das fun√ß√µes do c++-------------------------------------------------------
        try:
            self.testlib = ctypes.CDLL('../../build/lib/libblackboardpy.so') #chama a library que contem as fun√ß√µes em c++
        except OSError:
            try:
                self.testlib = ctypes.CDLL('../build/lib/libblackboardpy.so') #chama a library que contem as fun√ß√µes em c++
            except OSError:
                self.testlib = ctypes.CDLL('../AI/build/lib/libblackboardpy.so') #chama a library que contem as fun√ß√µes em c++
        self.testlib.using_shared_memory.restype = ctypes.POINTER(ctypes.c_int)
        mem = self.testlib.using_shared_memory(KEY)         #using c++ function
        #print 'python', mem
        self.testlib.read_float.restype = ctypes.c_float #defining the return type, that case defining float
        self.testlib.read_int.restype = ctypes.c_int #defining the return type, that case defining int
        return mem
        #--------------------------------------------------------------------------------------------------------------------

    # Criando fun√ß√£o que escreve float--------------------------------------------------------
    def write_float(self, mem, variable, value):
        self.testlib.write_float(mem, ctypes.c_int(self.variable_float[variable]), ctypes.c_float(value))
    #-----------------------------------------------------------------------------------------


    # Criando fun√ß√£o que escreve float--------------------------------------------------------
    def write_floatDynamic(self, mem, variable,index, value):
        self.testlib.write_float(mem, ctypes.c_int(self.variable_float[variable]+index), ctypes.c_float(value))
    #-----------------------------------------------------------------------------------------

    # Criando fun√ß√£o que escreve float--------------------------------------------------------
    def write_int(self, mem, variable, value):
        self.testlib.write_int(mem, ctypes.c_int(self.variable_int[variable]), ctypes.c_int(int(value)))
    #-----------------------------------------------------------------------------------------

    # Criando fun√ß√£o que l√™ float--------------------------------------------------------
    def read_float(self, mem, variable):
        return self.testlib.read_float(mem, ctypes.c_int(self.variable_float[variable]))
    #-----------------------------------------------------------------------------------------

    # Criando fun√ß√£o que l√™ float--------------------------------------------------------
    def read_int(self, mem, variable):
        return self.testlib.read_int(mem, ctypes.c_int(self.variable_int[variable]))
    #-----------------------------------------------------------------------------------------

    variable_int = {
    'PLANNING_COMMAND' : 0,
    'PLANNING_PARAMETER_VEL': 1,
    'PLANNING_PARAMETER_ANGLE': 2,
    'IMU_STATE' : 3,
    'IMU_RESET': 4,
    'CONTROL_ACTION': 13,
    'CONTROL_HEIGHT_A': 14,
    'CONTROL_HEIGHT_B': 15,
    'CONTROL_HEIGHT_C': 16,
    'DECISION_ACTION_A': 17,
    'DECISION_ACTION_B': 18,
    'DECISION_STATE': 19,
    'DECISION_POSITION_A': 20,
    'DECISION_POSITION_B': 21,
    'DECISION_POSITION_C': 22,
    'DECISION_BALL_POS': 23,
    'DECISION_OPP1_POS': 24,
    'DECISION_OPP2_POS': 25,
    'DECISION_OPP3_POS': 26,
    'COM_ACTION_ROBOT1': 27,
    'COM_ACTION_ROBOT2': 28,
    'COM_ACTION_ROBOT3': 29,
    'COM_STATE_ROBOT1': 30,
    'COM_STATE_ROBOT2': 31,
    'COM_STATE_ROBOT3': 32,
    'COM_POS_ROBOT1': 33,
    'COM_POS_ROBOT2': 34,
    'COM_POS_ROBOT3': 35,
    'COM_POS_BALL_ROBOT1': 36,
    'COM_POS_BALL_ROBOT2': 37,
    'COM_POS_BALL_ROBOT3': 38,
    'COM_POS_OPP_A_ROBOT1': 39,
    'COM_POS_OPP_A_ROBOT2': 40,
    'COM_POS_OPP_A_ROBOT3': 41,
    'COM_POS_OPP_A_ROBOT4': 42,
    'COM_POS_OPP_B_ROBOT1': 43,
    'COM_POS_OPP_B_ROBOT2': 44,
    'COM_POS_OPP_B_ROBOT3': 45,
    'COM_POS_OPP_B_ROBOT4': 46,
    'COM_POS_OPP_C_ROBOT1': 47,
    'COM_POS_OPP_C_ROBOT2': 48,
    'COM_POS_OPP_C_ROBOT3': 49,
    'COM_POS_OPP_C_ROBOT4': 50,
    'COM_REFEREE': 51,
    'LOCALIZATION_X': 52,
    'LOCALIZATION_Y': 53,
    'LOCALIZATION_THETA': 54,
    'VISION_LOST': 57,
    'DECISION_SEARCH_ON': 58,
    'DECISION_ACTION_VISION': 59,
    'VISION_MOTOR1_GOAL': 60,
    'VISION_MOTOR2_GOAL': 61,
    'VISION_SEARCH_GOAL': 62,
    'VISION_LOST_GOAL': 63,
    'VISION_STATE': 64,
    'ROBOT_NUMBER': 65,
    'VISION_pos_servo1': 66,
    'VISION_pos_servo2': 67,
    'COM_POS_ORIENT_QUALIT_ROBOT_A': 68,
    'COM_POS_DIST_QUALIT_ROBOT_A': 69,
    'COM_POS_ORIENT_QUALIT_ROBOT_B': 70,
    'COM_POS_DIST_QUALIT_ROBOT_B': 71,
    'COM_POS_ORIENT_QUALIT_ROBOT_C': 72,
    'COM_POS_DIST_QUALIT_ROBOT_C': 73,
    'VISION_DELTA_ORIENT': 74,
    'LOCALIZATION_FIND_ROBOT': 75,
    'RECEIVED_ROBOT_SENDING': 76,
    'RECEIVED_QUAL_ORIENT': 77,
    'RECEIVED_QUAL_DIST': 78,
    'RECEIVED_ROBOT_SEEN': 79,
    'CONTROL_MESSAGES': 80,
    'ASKED_QUALIT_DIRECT': 81,
    'ASKED_QUALIT_DISTANCE': 82,
    'ASKED_RELATED_ROBOT': 83,
    'CONTROL_MOVING': 84,
    'ROBOT_VIEW_ROTATE': 100,
    'CONTROL_WORKING': 101,
    'VISION_WORKING': 102,
    'LOCALIZATION_WORKING': 103,
    'DECISION_WORKING': 104,
    'IMU_WORKING': 105,
    'VOLTAGE': 106,
    'DECISION_LOCALIZATION': 107,
    'iVISION_FIELD': 108,
    }

    variable_float = {
        "IMU_GYRO_X": 0,
        "IMU_GYRO_Y": 1,
        "IMU_GYRO_Z": 2,
        "IMU_ACCEL_X": 3,
        "IMU_ACCEL_Y": 4,
        "IMU_ACCEL_Z": 5,
        "IMU_COMPASS_X": 6,
        "IMU_COMPASS_Y": 7,
        "IMU_COMPASS_Z": 8,
        "IMU_EULER_X": 9,
        "IMU_EULER_Y": 10,
        "IMU_EULER_Z": 11,
        "IMU_QUAT_X": 12,
        "IMU_QUAT_Y": 13,
        "IMU_QUAT_Z": 14,
        "VISION_AREA_SEGMENT": 15,
        "VISION_BALL_X": 16,
        "VISION_BALL_Y": 17,
        "VISION_BALL_TAG": 18,
        "VISION_LAND_X": 19,
        "VISION_LAND_Y": 20,
        "VISION_LAND_TAG": 21,
        "VISION_RB01_TAG": 22,
        "VISION_RB01_X": 23,
        "VISION_RB01_Y": 24,
        "VISION_RB01_TIME": 25,
        "VISION_RB02_TAG": 26,
        "VISION_RB02_X": 27,
        "VISION_RB02_Y": 28,
        "VISION_RB02_TIME": 29,
        "VISION_RB03_TAG": 30,
        "VISION_RB03_X": 31,
        "VISION_RB03_Y": 32,
        "VISION_RB03_TIME": 33,
        "VISION_RB04_TAG": 34,
        "VISION_RB04_X": 35,
        "VISION_RB04_Y": 36,
        "VISION_RB04_TIME": 37,
        "VISION_RB05_TAG": 38,
        "VISION_RB05_X": 39,
        "VISION_RB05_Y": 40,
        "VISION_RB05_TIME": 41,
        "VISION_RB06_TAG": 42,
        "VISION_RB06_X": 43,
        "VISION_RB06_Y": 44,
        "VISION_RB06_TIME": 45,
        "VISION_RB07_TAG": 46,
        "VISION_RB07_X": 47,
        "VISION_RB07_Y": 48,
        "VISION_RB07_TIME": 49,
        "VISION_RB08_TAG": 50,
        "VISION_RB08_X": 51,
        "VISION_RB08_Y": 52,
        "VISION_RB08_TIME": 53,
        "VISION_RB09_TAG": 54,
        "VISION_RB09_X": 55,
        "VISION_RB09_Y": 56,
        "VISION_RB09_TIME": 57,
        "VISION_RB10_TAG": 58,
        "VISION_RB10_X": 59,
        "VISION_RB10_Y": 60,
        "VISION_RB10_TIME": 61,
        "VISION_RB11_TAG": 62,
        "VISION_RB11_X": 63,
        "VISION_RB11_Y": 64,
        "VISION_RB11_TIME": 65,
        "VISION_RB12_TAG": 66,
        "VISION_RB12_X": 67,
        "VISION_RB12_Y": 68,
        "VISION_RB12_TIME": 69,
        "VISION_RB13_TAG": 70,
        "VISION_RB13_X": 71,
        "VISION_RB13_Y": 72,
        "VISION_RB13_TIME": 73,
        "VISION_RB14_TAG": 74,
        "VISION_RB14_X": 75,
        "VISION_RB14_Y": 76,
        "VISION_RB14_TIME": 77,
        "VISION_RB15_TAG": 78,
        "VISION_RB15_X": 79,
        "VISION_RB15_Y": 80,
        "VISION_RB15_TIME": 81,
        "VISION_RB16_TAG": 82,
        "VISION_RB16_X": 83,
        "VISION_RB16_Y": 84,
        "VISION_RB16_TIME": 85,
        "VISION_RB17_TAG": 86,
        "VISION_RB17_X": 87,
        "VISION_RB17_Y": 88,
        "VISION_RB17_TIME": 89,
        "VISION_RB18_TAG": 90,
        "VISION_RB18_X": 91,
        "VISION_RB18_Y": 92,
        "VISION_RB18_TIME": 93,
        "VISION_RB19_TAG": 94,
        "VISION_RB19_X": 95,
        "VISION_RB19_Y": 96,
        "VISION_RB19_TIME": 97,
        "VISION_RB20_TAG": 98,
        "VISION_RB20_X": 99,
        "VISION_RB20_Y": 100,
        "VISION_RB20_TIME": 101,
        "VISION_RB21_TAG": 102,
        "VISION_RB21_X": 103,
        "VISION_RB21_Y": 104,
        "VISION_RB21_TIME": 105,
        "VISION_RB22_TAG": 106,
        "VISION_RB22_X": 107,
        "VISION_RB22_Y": 108,
        "VISION_RB22_TIME": 109,
        "VISUAL_MEMORY_AL_01_X": 110,
        "VISUAL_MEMORY_AL_01_Y": 111,
        "VISUAL_MEMORY_AL_01_MAX_VEL": 112,
        "VISUAL_MEMORY_AL_02_X": 113,
        "VISUAL_MEMORY_AL_02_Y": 114,
        "VISUAL_MEMORY_AL_02_MAX_VEL": 115,
        "VISUAL_MEMORY_AL_03_X": 116,
        "VISUAL_MEMORY_AL_03_Y": 117,
        "VISUAL_MEMORY_AL_03_MAX_VEL": 118,
        "VISUAL_MEMORY_AL_04_X": 119,
        "VISUAL_MEMORY_AL_04_Y": 120,
        "VISUAL_MEMORY_AL_04_MAX_VEL": 121,
        "VISUAL_MEMORY_AL_05_X": 122,
        "VISUAL_MEMORY_AL_05_Y": 123,
        "VISUAL_MEMORY_AL_05_MAX_VEL": 124,
        "VISUAL_MEMORY_AL_06_X": 125,
        "VISUAL_MEMORY_AL_06_Y": 126,
        "VISUAL_MEMORY_AL_06_MAX_VEL": 127,
        "VISUAL_MEMORY_AL_07_X": 128,
        "VISUAL_MEMORY_AL_07_Y": 129,
        "VISUAL_MEMORY_AL_07_MAX_VEL": 130,
        "VISUAL_MEMORY_AL_08_X": 131,
        "VISUAL_MEMORY_AL_08_Y": 132,
        "VISUAL_MEMORY_AL_08_MAX_VEL": 133,
        "VISUAL_MEMORY_AL_09_X": 134,
        "VISUAL_MEMORY_AL_09_Y": 135,
        "VISUAL_MEMORY_AL_09_MAX_VEL": 136,
        "VISUAL_MEMORY_AL_10_X": 137,
        "VISUAL_MEMORY_AL_10_Y": 138,
        "VISUAL_MEMORY_AL_10_MAX_VEL": 139,
        "VISUAL_MEMORY_OP_01_X": 140,
        "VISUAL_MEMORY_OP_01_Y": 141,
        "VISUAL_MEMORY_OP_01_MAX_VEL": 142,
        "VISUAL_MEMORY_OP_02_X": 143,
        "VISUAL_MEMORY_OP_02_Y": 144,
        "VISUAL_MEMORY_OP_02_MAX_VEL": 145,
        "VISUAL_MEMORY_OP_03_X": 146,
        "VISUAL_MEMORY_OP_03_Y": 147,
        "VISUAL_MEMORY_OP_03_MAX_VEL": 148,
        "VISUAL_MEMORY_OP_04_X": 149,
        "VISUAL_MEMORY_OP_04_Y": 150,
        "VISUAL_MEMORY_OP_04_MAX_VEL": 151,
        "VISUAL_MEMORY_OP_05_X": 152,
        "VISUAL_MEMORY_OP_05_Y": 153,
        "VISUAL_MEMORY_OP_05_MAX_VEL": 154,
        "VISUAL_MEMORY_OP_06_X": 155,
        "VISUAL_MEMORY_OP_06_Y": 156,
        "VISUAL_MEMORY_OP_06_MAX_VEL": 157,
        "VISUAL_MEMORY_OP_07_X": 158,
        "VISUAL_MEMORY_OP_07_Y": 159,
        "VISUAL_MEMORY_OP_07_MAX_VEL": 160,
        "VISUAL_MEMORY_OP_08_X": 161,
        "VISUAL_MEMORY_OP_08_Y": 162,
        "VISUAL_MEMORY_OP_08_MAX_VEL": 163,
        "VISUAL_MEMORY_OP_09_X": 164,
        "VISUAL_MEMORY_OP_09_Y": 165,
        "VISUAL_MEMORY_OP_09_MAX_VEL": 166,
        "VISUAL_MEMORY_OP_10_X": 167,
        "VISUAL_MEMORY_OP_10_Y": 168,
        "VISUAL_MEMORY_OP_10_MAX_VEL": 169,
        "VISUAL_MEMORY_OP_11_X": 170,
        "VISUAL_MEMORY_OP_11_Y": 171,
        "VISUAL_MEMORY_OP_11_MAX_VEL": 172,
        "VISION_TILT_DEG": 173,
        "VISION_PAN_DEG": 174,
        "CBR_COORDINATOR": 175,
        "CBR_RUN": 176,
        "LOCALIZATION_BALL_X": 177,
        "LOCALIZATION_BALL_Y": 178,
        "LOCALIZATION_RBT01_X": 179,
        "LOCALIZATION_RBT01_Y": 180,
        "LOCALIZATION_RBT02_X": 181,
        "LOCALIZATION_RBT02_Y": 182,
        "LOCALIZATION_RBT03_X": 183,
        "LOCALIZATION_RBT03_Y": 184,
        "LOCALIZATION_RBT04_X": 185,
        "LOCALIZATION_RBT04_Y": 186,
        "LOCALIZATION_RBT05_X": 187,
        "LOCALIZATION_RBT05_Y": 188,
        "LOCALIZATION_RBT06_X": 189,
        "LOCALIZATION_RBT06_Y": 190,
        "LOCALIZATION_RBT07_X": 191,
        "LOCALIZATION_RBT07_Y": 192,
        "LOCALIZATION_RBT08_X": 193,
        "LOCALIZATION_RBT08_Y": 194,
        "LOCALIZATION_RBT09_X": 195,
        "LOCALIZATION_RBT09_Y": 196,
        "LOCALIZATION_RBT10_X": 197,
        "LOCALIZATION_RBT10_Y": 198,
        "LOCALIZATION_RBT11_X": 199,
        "LOCALIZATION_RBT11_Y": 200,
        "LOCALIZATION_OPP01_X": 201,
        "LOCALIZATION_OPP01_Y": 202,
        "LOCALIZATION_OPP02_X": 203,
        "LOCALIZATION_OPP02_Y": 204,
        "LOCALIZATION_OPP03_X": 205,
        "LOCALIZATION_OPP03_Y": 206,
        "LOCALIZATION_OPP04_X": 207,
        "LOCALIZATION_OPP04_Y": 208,
        "LOCALIZATION_OPP05_X": 209,
        "LOCALIZATION_OPP05_Y": 210,
        "LOCALIZATION_OPP06_X": 211,
        "LOCALIZATION_OPP06_Y": 212,
        "LOCALIZATION_OPP07_X": 213,
        "LOCALIZATION_OPP07_Y": 214,
        "LOCALIZATION_OPP08_X": 215,
        "LOCALIZATION_OPP08_Y": 216,
        "LOCALIZATION_OPP09_X": 217,
        "LOCALIZATION_OPP09_Y": 218,
        "LOCALIZATION_OPP10_X": 219,
        "LOCALIZATION_OPP10_Y": 220,
        "LOCALIZATION_OPP11_X": 221,
        "LOCALIZATION_OPP11_Y": 222,
        "DECISION_RBT01_DIST_BALL": 223,
        "DECISION_RBT02_DIST_BALL": 224,
        "DECISION_RBT03_DIST_BALL": 225,
        "DECISION_RBT04_DIST_BALL": 226,
        "VISION_FIRST_GOALPOST": 227,
        "VISION_SECOND_GOALPOST": 228,
        "VISION_THIRD_GOALPOST": 229,
        "VISION_FOURTH_GOALPOST": 230,
        "fVISION_FIELD": 231
    }
#------------------------------------------------------------------------------------------
